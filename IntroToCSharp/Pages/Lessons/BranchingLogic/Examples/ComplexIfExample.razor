
<Text>
    The code block below is part of a program that has already 
    displayed a message to the user. Use the <b>Next</b> and <b>Back</b> buttons to step through
    the execution of the code block.
</Text>
<ConditionalCodeStepper InitialOutput="@InitialOutput" SourceCode="@ComplexIfExampleSource.Code">
    <CodeStep ID="Init" Line=1>
        <Explanation>
            <BeforeInitialize VarName="userName" Expr="Console.ReadLine()!"/>
        </Explanation>
    </CodeStep>

    <ReadLineState ID="Foo" @bind-Value="UserInput" Line=1/>

    <CodeStep ID="Step2" Line=1>
        <Explanation>
            <EvalReadLineExplanation/>
        </Explanation>
    </CodeStep>

    <CodeStep ID="Step3" Line=1>
        <Explanation>
            <InitializeExplanation Value="@UserInputExpr" VarName="userInput"/>
        </Explanation>
    </CodeStep>

    <CodeStep ID="Step4" Line=2>
        <Explanation>
            <EvalExpressionExplanation Expr="@("userInput == \"1\"")" />
        </Explanation>
    </CodeStep>

    <CodeStep ID="Step5" Line=2 SubVarName="userInput" SubValue="@UserInputExpr">
        <Explanation>
            <ReadVariableExplanation Name="userInput" />
        </Explanation>
    </CodeStep>

    <CodeStep ID="Step6" Line=2 SubVarName="@GetCompare(1)" SubValue="@GetComparResult(1)">
        <Explanation>
            <EqualityEvalExplanation LeftValue="@UserInputExpr" RightValue="@("\"1\"")" />
        </Explanation>
    </CodeStep>

    <CodeStep ID="Check1" Line=2 NextId="@GetNextId(1)">
        <Explanation>
            <IfStatementExplanation Conditional="@GetCondition(1)" />
        </Explanation>
    </CodeStep>

    <CodeStep ID="Check2" Line=6>
        <Explanation>
            <EvalExpressionExplanation Expr="@("userInput == \"2\"")" />
        </Explanation>
    </CodeStep>

    <CodeStep ID="Check2-1" Line=6 SubVarName="userInput" SubValue="@UserInputExpr">
        <Explanation>
            <ReadVariableExplanation Name="userInput" />
        </Explanation>
    </CodeStep>

    <CodeStep ID="Check2-2" Line=6 SubVarName="@GetCompare(2)" SubValue="@GetComparResult(2)">
        <Explanation>
            <EqualityEvalExplanation LeftValue="@UserInputExpr" RightValue="@("\"2\"")" />
        </Explanation>
    </CodeStep>

    <CodeStep ID="Check2-3" Line=6 NextId="@GetNextId(2)">
        <Explanation>
            <IfStatementExplanation Conditional="@GetCondition(2)" />
        </Explanation>
    </CodeStep>

    <CodeStep ID="Check3" Line=10>
        <Explanation>
            <EvalExpressionExplanation Expr="@("userInput == \"3\"")" />
        </Explanation>
    </CodeStep>

    <CodeStep ID="Check3-1" Line=10 SubVarName="userInput" SubValue="@UserInputExpr">
        <Explanation>
            <ReadVariableExplanation Name="userInput" />
        </Explanation>
    </CodeStep>

    <CodeStep ID="Check3-2" Line=10 SubVarName="@GetCompare(3)" SubValue="@GetComparResult(3)">
        <Explanation>
            <EqualityEvalExplanation LeftValue="@UserInputExpr" RightValue="@("\"3\"")" />
        </Explanation>
    </CodeStep>

    <CodeStep ID="Check3-3" Line=10 NextId="@GetNextId(3)">
        <Explanation>
            <IfStatementExplanation Conditional="@GetCondition(3)" />
        </Explanation>
    </CodeStep>

    <CodeStep ID="DoElse" Line=14>
        <Explanation>
            <ElseExplanation/>
        </Explanation>
    </CodeStep>

    <CodeStep ID="DoElse-2" Line=16 OutputLine="Invalid Choice!" NextId="Last">
        <Explanation>
            <DisplayExplanation Output="Invalid Choice!" />
        </Explanation>
    </CodeStep>

    <CodeStep ID="UserInputIs1" Line=4 OutputLine="You enter the cave and prepare to face the dragon!">
        <Explanation>
            <DisplayExplanation Output="You enter the cave and prepare to face the dragon!" />
        </Explanation>
    </CodeStep>
    <CodeStep ID="EndOfIf1" Line=5 NextId="Last">
        <Explanation>
            <EndOfIfExplanation />
        </Explanation>
    </CodeStep>

    <CodeStep ID="UserInputIs2" Line=8 OutputLine="You return to town to buy supplies.">
        <Explanation>
            <DisplayExplanation Output="You return to town to buy supplies." />
        </Explanation>
    </CodeStep>
    <CodeStep ID="EndOfIf2" Line=9 NextId="Last">
        <Explanation>
            <EndOfIfExplanation />
        </Explanation>
    </CodeStep>

    <CodeStep ID="UserInputIs3" Line=12 OutputLine="You run home to the safety of your warm bed.">
        <Explanation>
            <DisplayExplanation Output="You run home to the safety of your warm bed." />
        </Explanation>
    </CodeStep>
    <CodeStep ID="EndOfIf3" Line=13 NextId="Last">
        <Explanation>
            <EndOfIfExplanation />
        </Explanation>
    </CodeStep>

    <CodeStep ID="Last" Line=17 >
        <Explanation>
            There is no more code to execute and the program exits.
        </Explanation>
    </CodeStep>

</ConditionalCodeStepper>

@code {
    private bool GetCondition(int n)  => UserInput == $"{n}";
    private string GetNextId(int n) {
        if (n == 1) {
            if (UserInput == "1") {
                return "UserInputIs1";
            } else {
                return "Check2";
            }
        }
        if (n == 2) {
            if (UserInput == "2") {
                return "UserInputIs2";
            } else {
                return "Check3";
            }
        }
        if (n == 3) {
            if (UserInput == "3") {
                return "UserInputIs3";
            } else {
                return "DoElse";
            }
        }
        return "";
    }
    private string GetCompare(int n) => $"{UserInputExpr} == \"{n}\"";
    private string GetComparResult(int n) => (UserInput == $"{n}").ToString().ToLower();
    private string InitialOutput = @"
You stand at the entrance to the dragon's lair. Dare you enter?

1. Enter the Cave
2. Return to Town
3. Run home and go to sleep

Enter a choice: ".TrimStart();
    private string UserInput { get; set; } = string.Empty;
    private string UserInputExpr => "\"" + UserInput.Replace("\\", "\\\\").Replace("\"", "\\\"") + "\"";
}