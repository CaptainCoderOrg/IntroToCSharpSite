<MudCard Class="ma-2" Outlined="true" Style="width: 450px">
    <MudCardMedia Image="@Item.Image" Height="200" />
    <MudCardContent Class="pa-2">
        <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
            <MudText Class="mr-4" Typo="Typo.h5">@Item.Name</MudText>
            <MudStack AlignItems="AlignItems.Center" Row="true" Class="ml-4 border-2 mud-border-default rounded-pill">
                <MudImage Class="ml-3 mr-0 mt-2 mb-2" Src="/imgs/top-menu/coin.png" Width="25" Height="25"></MudImage>
                <MudText Class="mr-3 ml-0" Typo="Typo.body1">@Item.Cost.ToString("#,##")</MudText>
            </MudStack>
        </MudStack>
        <MudText Typo="Typo.body2">@Item.Description</MudText>
    </MudCardContent>
    <MudCardActions>
        <MudButton OnClick="@Purchase" Variant="Variant.Filled" Color="Color.Success" Class="pl-8 pr-8"
            FullWidth="true">Buy</MudButton>
    </MudCardActions>
</MudCard>


@code {
    [Parameter]
    public StoreItem Item { get; set; }

    private UserStats _userData { get; set; } = UserStats.Default;

    public void Purchase()
    {
        if (_userData.Gold > Item.Cost)
        {
            UserService.Service.GiveGold(Item.Cost * -1);

        }
    }

    protected override void OnInitialized()
    {
        UserService.Service.OnUserChange += this.UpdateUser;
    }

    private void UpdateUser(User newUser)
    {
        if (newUser.IsLoggedIn && newUser.UserStatsRef != null) {
            newUser.UserStatsRef.DataChangedEvent += UpdateUserData;
        }
    }

    private void UpdateUserData(UserStats? newUserData)
    {
        if (newUserData == null) return;
        this._userData = newUserData;
        this.StateHasChanged();
    }

}